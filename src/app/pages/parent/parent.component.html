<!-- PAGE HEADER -->
<div class="page-header d-flex justify-content-between align-items-center mb-4 flex-wrap">
  <div class="page-title">
    <h4 class="fw-bold text-primary">Parents List</h4>
    <h6 class="text-muted">View/Search Parents</h6>
  </div>
  <div class="page-btn mt-2 mt-md-0">
    <button class="btn btn-primary btn-sm shadow-sm rounded-3" data-bs-toggle="modal" data-bs-target="#parentModal">
      <i class="bi bi-plus-circle me-1"></i> Add Parent
    </button>
  </div>
</div>

<!-- CARD -->
<div class="card shadow-sm border-0 rounded-4">
  <div class="card-body">

    <!-- Table Top: Search & Filter -->
    <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
      <div class="d-flex align-items-center mb-2">
        
      </div>
       <div class="input-group mb-2" style="max-width: 250px;">
  <input type="text" class="form-control form-control-sm shadow-sm"
         placeholder="Search Parent" [(ngModel)]="searchText" (input)="filterParents()">
  <button class="btn btn-primary btn-sm" (click)="filterParents()">
    <i class="bi bi-search"></i>
  </button>
</div>

    </div>

    <!-- Table -->
    <div class="table-responsive">
      <table class="table table-hover table-striped align-middle text-center mb-0 shadow-sm rounded-3">
        <thead class="table-light">
          <tr>
            <th>Nom et Prénom</th>
            <th>Relation</th>
            <th>CIN</th>
            <th>Adresse</th>
            <th>Téléphone Principal</th>
            <th>Téléphone Secondaire</th>
            <th>Email</th>
            <th>Profession</th>
            <th>Lieu Travail</th>
            <th>Téléphone Travail</th>
            <th>Contact Urgence Nom</th>
            <th>Contact Urgence Tel</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
<tr *ngFor="let p of filteredParents">
            <td class="fw-semibold">{{ p.nom + ' ' + p.prenom }}</td>
            <td>{{ p.relation }}</td>
            <td>{{ p.cin }}</td>
            <td>{{ p.adresse }}</td>
            <td>{{ p.telPrincipal }}</td>
            <td>{{ p.telSecondaire }}</td>
            <td>{{ p.email }}</td>
            <td>{{ p.profession }}</td>
            <td>{{ p.lieuTravail }}</td>
            <td>{{ p.telTravail }}</td>
            <td>{{ p.contactUrgenceNom }}</td>
            <td>{{ p.contactUrgenceTel }}</td>
            <td>
              <span class="badge" [ngClass]="p.etat ? 'bg-primary' : 'bg-danger'">
                {{ p.etat ? 'ACTIVATED' : 'DESACTIVATED' }}
              </span>
            </td>
            <td class="d-flex justify-content-center gap-1">
              <button class="btn btn-sm btn-outline-success" (click)="goToEnfantPage(p.id)" title="Add Enfant">
                <i class="bi bi-plus-circle"></i>
              </button>
              <button class="btn btn-sm btn-outline-warning" (click)="editParent(p)" title="Edit">
                <i class="bi bi-pencil-square"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteParent(p.id)" title="Delete">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="parents.length === 0">
            <td colspan="14" class="text-center fst-italic text-muted">No Parents Found</td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>

<!-- Modal Add/Edit Parent -->
<div class="modal fade" id="parentModal" tabindex="-1" aria-labelledby="parentModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content shadow-lg rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="parentModalTitle">{{ isEdit ? 'Edit Parent' : 'Add Parent' }}</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form #form="ngForm" (ngSubmit)="saveParent(form)">
          <div class="row g-3">

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Nom</label>
              <input type="text" [(ngModel)]="parent.nom" name="nom" class="form-control shadow-sm" required>
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Prénom</label>
              <input type="text" [(ngModel)]="parent.prenom" name="prenom" class="form-control shadow-sm" required>
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Relation</label>
              <select class="form-select shadow-sm" [(ngModel)]="parent.relation" name="relation" required>
                <option value="PERE">Père</option>
                <option value="MERE">Mère</option>
                <option value="TUTEUR">Tuteur</option>
              </select>
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">CIN</label>
              <input type="text" [(ngModel)]="parent.cin" name="cin" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Adresse</label>
              <input type="text" [(ngModel)]="parent.adresse" name="adresse" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Téléphone Principal</label>
              <input type="text" [(ngModel)]="parent.telPrincipal" name="telPrincipal" class="form-control shadow-sm" required>
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Téléphone Secondaire</label>
              <input type="text" [(ngModel)]="parent.telSecondaire" name="telSecondaire" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Email</label>
              <input type="email" [(ngModel)]="parent.email" name="email" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Profession</label>
              <input type="text" [(ngModel)]="parent.profession" name="profession" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Lieu de Travail</label>
              <input type="text" [(ngModel)]="parent.lieuTravail" name="lieuTravail" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Téléphone Travail</label>
              <input type="text" [(ngModel)]="parent.telTravail" name="telTravail" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Contact Urgence Nom</label>
              <input type="text" [(ngModel)]="parent.contactUrgenceNom" name="contactUrgenceNom" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Contact Urgence Téléphone</label>
              <input type="text" [(ngModel)]="parent.contactUrgenceTel" name="contactUrgenceTel" class="form-control shadow-sm">
            </div>

            <div class="col-lg-6 col-sm-6 col-12">
              <label class="form-label fw-semibold">Status</label>
              <select class="form-select shadow-sm" [(ngModel)]="parent.etat" name="etat">
                <option [ngValue]="true">Activé</option>
                <option [ngValue]="false">Désactivé</option>
              </select>
            </div>

            <div class="col-12 mt-3 d-flex justify-content-end gap-2">
              <button type="submit" class="btn btn-primary shadow-sm">
                {{ isEdit ? 'Update Parent' : 'Add Parent' }}
              </button>
              <button type="reset" class="btn btn-outline-danger shadow-sm" data-bs-dismiss="modal">Cancel</button>
            </div>

          </div>
        </form>
      </div>
    </div>
  </div>
</div>
